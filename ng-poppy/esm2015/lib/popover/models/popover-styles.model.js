const SPACE_FROM_BOTTOM = 20;
const SPACE_FROM_TOP = 10;
const HORIZONTAL_SPACE = 10;
const POSITION_MEASURE_UNIT = 'px';
export class PopoverStyles {
    constructor(popover) {
        this.initHostElementWidth = 0;
        this.popover = popover;
        this.hostElement = popover.element;
        this.config = popover.popoverConfig;
        this.type = this.config.type;
        this.position = this.config.position;
    }
    init() {
        const hostBounds = this.config.bounds;
        this.hostElement.nativeElement.style.zIndex = 10000;
        this.setPositionStyle('left', 0);
        this.setPositionStyle('top', +hostBounds.top + hostBounds.height + SPACE_FROM_TOP);
        if (!this.isContextType && !this.isSubmenuType) {
            this.hostElement.nativeElement.style.minWidth = hostBounds.width + 'px';
        }
        if (this.isContextType) {
            this.setPositionStyle('top', +hostBounds.top);
            this.hostElement.nativeElement.style.minWidth = 0;
        }
        if (this.isSubmenuType) {
            const triggerItem = this.config.submenuTriggeredItem.element.nativeElement;
            const triggerBounds = triggerItem.getBoundingClientRect();
            this.hostElement.nativeElement.style.minWidth = 0;
            this.setPositionStyle('top', triggerBounds.top);
        }
        if (this.canAssignPadding) {
            const padding = this.isTooltip ? '8px 12px' : '15px 25px';
            this.popover.popoverWrapperEl.nativeElement.style.padding = padding;
        }
        this.hostElement.nativeElement.style.visibility = 'hidden';
        setTimeout(() => {
            this.initHostElementWidth = this.hostElement.nativeElement.offsetWidth + 1;
            this.hostElement.nativeElement.style.minWidth = this.initHostElementWidth + 'px';
        });
    }
    update() {
        this.setLeftPosition();
        this.setTopPosition();
        this.setWidth();
        this.hostElement.nativeElement.style.visibility = 'visible';
    }
    setTopPosition() {
        const windowHeight = window.innerHeight;
        const elementHeight = this.hostElement.nativeElement.getBoundingClientRect().height;
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (this.config.triggerDirective) {
            const hostTopPosition = this.config.type === 'context' ? this.config.bounds.top : triggerBounds.top + triggerBounds.height;
            const isBelowWindowCenterHeight = elementHeight >= windowHeight - hostTopPosition - SPACE_FROM_BOTTOM;
            if (isBelowWindowCenterHeight) {
                if (this.config.type === 'context') {
                    this.setPositionStyle('top', +this.config.bounds.top - elementHeight + SPACE_FROM_TOP);
                }
                else {
                    const newPos = triggerBounds.top - elementHeight - SPACE_FROM_TOP;
                    if (newPos > 0) {
                        switch (this.position) {
                            case 'bottom':
                                this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);
                                break;
                            case 'top':
                                this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);
                        }
                    }
                    else {
                        this.hostElement.nativeElement.style.height =
                            windowHeight - hostTopPosition - SPACE_FROM_BOTTOM + POSITION_MEASURE_UNIT;
                    }
                }
            }
            else {
                if (this.config.type === 'context') {
                    this.setPositionStyle('top', +this.config.bounds.top + SPACE_FROM_TOP);
                }
                else {
                    switch (this.position) {
                        case 'bottom':
                            this.setPositionStyle('top', triggerBounds.top + triggerBounds.height + SPACE_FROM_TOP);
                            break;
                        case 'top':
                            this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);
                            break;
                        case 'left':
                        case 'right':
                            this.setPositionStyle('top', triggerBounds.top - (elementHeight / 2 - triggerBounds.height / 2));
                            break;
                    }
                }
            }
        }
        if (!this.config.triggerDirective) {
            const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();
            const hostPosition = hostBounds.top;
            if (elementHeight >= windowHeight - hostPosition - SPACE_FROM_BOTTOM) {
                const diff = elementHeight - (windowHeight - hostPosition);
                this.setPositionStyle('top', hostPosition - diff - SPACE_FROM_BOTTOM);
            }
            else {
                this.setPositionStyle('top', hostPosition);
            }
        }
    }
    setLeftPosition() {
        const windowWidth = window.innerWidth;
        const elementWidth = this.hostElement.nativeElement.getBoundingClientRect().width;
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (this.isContextType) {
            if (+this.config.bounds.left >= windowWidth / 2) {
                this.setPositionStyle('left', +this.config.bounds.left - elementWidth);
            }
            else {
                this.setPositionStyle('left', this.defaultLeftPosition);
            }
        }
        else if (this.config.triggerDirective) {
            switch (this.position) {
                case 'bottom':
                case 'top':
                    this.setPositionStyle('left', triggerBounds.left);
                    break;
                case 'left':
                    this.setPositionStyle('left', triggerBounds.left - elementWidth - HORIZONTAL_SPACE);
                    break;
                case 'right':
                    this.setPositionStyle('left', triggerBounds.left + triggerBounds.width + HORIZONTAL_SPACE);
                    break;
            }
            const hostRecBounds = this.hostElement.nativeElement.getBoundingClientRect();
            if (hostRecBounds.right > windowWidth - 20) {
                this.setPositionStyle('left', hostRecBounds.left - (hostRecBounds.right - windowWidth + 20));
            }
            if (hostRecBounds.left < 0) {
                this.setPositionStyle('left', 15);
            }
        }
        else {
            const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();
            if (elementWidth > windowWidth - hostBounds.right) {
                this.setPositionStyle('left', hostBounds.left - this.initHostElementWidth);
            }
            else {
                this.setPositionStyle('left', hostBounds.right);
            }
        }
    }
    setWidth() {
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (!this.isContextType && !this.isSubmenuType) {
            const windowWidth = window.innerWidth;
            const hostElBounds = this.hostElement.nativeElement.getBoundingClientRect();
            this.hostElement.nativeElement.style.minWidth = this.initHostElementWidth + POSITION_MEASURE_UNIT;
            if (!this.isMenuType) {
                if (hostElBounds.width > windowWidth || this.initHostElementWidth > windowWidth - 30) {
                    this.hostElement.nativeElement.style.width = windowWidth - 30 + POSITION_MEASURE_UNIT;
                    this.hostElement.nativeElement.style.minWidth = windowWidth - 30 + POSITION_MEASURE_UNIT;
                    this.setPositionStyle('left', 15);
                }
            }
        }
    }
    setPositionStyle(property, value) {
        this.hostElement.nativeElement.style[property] = value + POSITION_MEASURE_UNIT;
    }
    get defaultLeftPosition() {
        return this.config.bounds.left;
    }
    get canAssignPadding() {
        return ((!this.isContextType && !this.isMenuType && !this.isSubmenuType) ||
            (this.isSubmenuType && !!this.config.content));
    }
    get isContextType() {
        return this.type === 'context';
    }
    get isMenuType() {
        return this.type === 'menu';
    }
    get isSubmenuType() {
        return this.type === 'submenu';
    }
    get isTooltip() {
        return this.type === 'tooltip';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci1zdHlsZXMubW9kZWwuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvZm9sdGkvUHJvamVjdHMvbmctcG9wcHkvcHJvamVjdHMvbmctcG9wcHkvc3JjLyIsInNvdXJjZXMiOlsibGliL3BvcG92ZXIvbW9kZWxzL3BvcG92ZXItc3R5bGVzLm1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLE1BQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBQzdCLE1BQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQztBQUMxQixNQUFNLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztBQUM1QixNQUFNLHFCQUFxQixHQUFHLElBQUksQ0FBQztBQUVuQyxNQUFNLE9BQU8sYUFBYTtJQVF4QixZQUFZLE9BQWdDO1FBRnBDLHlCQUFvQixHQUFXLENBQUMsQ0FBQztRQUd2QyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDbkMsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztJQUN2QyxDQUFDO0lBRUQsSUFBSTtRQUNGLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1FBRXRDLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRXBELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEdBQUcsVUFBVSxDQUFDLE1BQU0sR0FB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LFNBQVMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsSUFBWSxVQUFVO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUM7SUFDOUIsQ0FBQztJQUVELElBQVksYUFBYTtRQUN2QixPQUFPLElBQUksQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxJQUFZLFNBQVM7UUFDbkIsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQztJQUNqQyxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQb3BvdmVyQ29uZmlnIH0gZnJvbSAnLi4vcG9wb3Zlci50b2tlbic7XG5pbXBvcnQgeyBQb3BvdmVyUG9zaXRpb24sIFBvcG92ZXJUeXBlIH0gZnJvbSAnLi4vcG9wb3Zlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9wb3ZlckNvbnRlbnRDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL3BvcG92ZXItY29udGVudC9wb3BvdmVyLWNvbnRlbnQuY29tcG9uZW50JztcblxuY29uc3QgU1BBQ0VfRlJPTV9CT1RUT00gPSAyMDtcbmNvbnN0IFNQQUNFX0ZST01fVE9QID0gMTA7XG5jb25zdCBIT1JJWk9OVEFMX1NQQUNFID0gMTA7XG5jb25zdCBQT1NJVElPTl9NRUFTVVJFX1VOSVQgPSAncHgnO1xuXG5leHBvcnQgY2xhc3MgUG9wb3ZlclN0eWxlcyB7XG4gIHByaXZhdGUgcG9wb3ZlcjogUG9wb3ZlckNvbnRlbnRDb21wb25lbnQ7XG4gIHByaXZhdGUgaG9zdEVsZW1lbnQ6IEVsZW1lbnRSZWY8YW55PjtcbiAgcHJpdmF0ZSBjb25maWc6IFBvcG92ZXJDb25maWc7XG4gIHByaXZhdGUgdHlwZTogUG9wb3ZlclR5cGU7XG4gIHByaXZhdGUgcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbjtcbiAgcHJpdmF0ZSBpbml0SG9zdEVsZW1lbnRXaWR0aDogbnVtYmVyID0gMDtcblxuICBjb25zdHJ1Y3Rvcihwb3BvdmVyOiBQb3BvdmVyQ29udGVudENvbXBvbmVudCkge1xuICAgIHRoaXMucG9wb3ZlciA9IHBvcG92ZXI7XG4gICAgdGhpcy5ob3N0RWxlbWVudCA9IHBvcG92ZXIuZWxlbWVudDtcbiAgICB0aGlzLmNvbmZpZyA9IHBvcG92ZXIucG9wb3ZlckNvbmZpZztcbiAgICB0aGlzLnR5cGUgPSB0aGlzLmNvbmZpZy50eXBlO1xuICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLmNvbmZpZy5wb3NpdGlvbjtcbiAgfVxuXG4gIGluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgaG9zdEJvdW5kcyA9IHRoaXMuY29uZmlnLmJvdW5kcztcblxuICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS56SW5kZXggPSAxMDAwMDtcblxuICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIDApO1xuICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgK2hvc3RCb3VuZHMudG9wICsgaG9zdEJvdW5kcy5oZWlnaHQgKyBTUEFDRV9GUk9NX1RPUCk7XG5cbiAgICBpZiAoIXRoaXMuaXNDb250ZXh0VHlwZSAmJiAhdGhpcy5pc1N1Ym1lbnVUeXBlKSB7XG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBob3N0Qm91bmRzLndpZHRoICsgJ3B4JztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0NvbnRleHRUeXBlKSB7XG4gICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsICtob3N0Qm91bmRzLnRvcCk7XG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSAwO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzU3VibWVudVR5cGUpIHtcbiAgICAgIGNvbnN0IHRyaWdnZXJJdGVtID0gdGhpcy5jb25maWcuc3VibWVudVRyaWdnZXJlZEl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgICAgY29uc3QgdHJpZ2dlckJvdW5kczogQ2xpZW50UmVjdCA9IHRyaWdnZXJJdGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSAwO1xuICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCB0cmlnZ2VyQm91bmRzLnRvcCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2FuQXNzaWduUGFkZGluZykge1xuICAgICAgY29uc3QgcGFkZGluZyA9IHRoaXMuaXNUb29sdGlwID8gJzhweCAxMnB4JyA6ICcxNXB4IDI1cHgnO1xuICAgICAgdGhpcy5wb3BvdmVyLnBvcG92ZXJXcmFwcGVyRWwubmF0aXZlRWxlbWVudC5zdHlsZS5wYWRkaW5nID0gcGFkZGluZztcbiAgICB9XG5cbiAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmluaXRIb3N0RWxlbWVudFdpZHRoID0gdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoICsgMTtcbiAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMuaW5pdEhvc3RFbGVtZW50V2lkdGggKyAncHgnO1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlKCk6IHZvaWQge1xuICAgIHRoaXMuc2V0TGVmdFBvc2l0aW9uKCk7XG4gICAgdGhpcy5zZXRUb3BQb3NpdGlvbigpO1xuICAgIHRoaXMuc2V0V2lkdGgoKTtcblxuICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb3BQb3NpdGlvbigpOiB2b2lkIHtcbiAgICBjb25zdCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgY29uc3QgZWxlbWVudEhlaWdodCA9IHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgY29uc3QgdHJpZ2dlckJvdW5kcyA9IHRoaXMuY29uZmlnLnRyaWdnZXJFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBpZiAodGhpcy5jb25maWcudHJpZ2dlckRpcmVjdGl2ZSkge1xuICAgICAgY29uc3QgaG9zdFRvcFBvc2l0aW9uID1cbiAgICAgICAgdGhpcy5jb25maWcudHlwZSA9PT0gJ2NvbnRleHQnID8gdGhpcy5jb25maWcuYm91bmRzLnRvcCA6IHRyaWdnZXJCb3VuZHMudG9wICsgdHJpZ2dlckJvdW5kcy5oZWlnaHQ7XG4gICAgICBjb25zdCBpc0JlbG93V2luZG93Q2VudGVySGVpZ2h0ID0gZWxlbWVudEhlaWdodCA+PSB3aW5kb3dIZWlnaHQgLSBob3N0VG9wUG9zaXRpb24gLSBTUEFDRV9GUk9NX0JPVFRPTTtcblxuICAgICAgaWYgKGlzQmVsb3dXaW5kb3dDZW50ZXJIZWlnaHQpIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnR5cGUgPT09ICdjb250ZXh0Jykge1xuICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgK3RoaXMuY29uZmlnLmJvdW5kcy50b3AgLSBlbGVtZW50SGVpZ2h0ICsgU1BBQ0VfRlJPTV9UT1ApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IG5ld1BvcyA9IHRyaWdnZXJCb3VuZHMudG9wIC0gZWxlbWVudEhlaWdodCAtIFNQQUNFX0ZST01fVE9QO1xuICAgICAgICAgIGlmIChuZXdQb3MgPiAwKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMucG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsIHRyaWdnZXJCb3VuZHMudG9wIC0gZWxlbWVudEhlaWdodCAtIFNQQUNFX0ZST01fVE9QKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsIHRyaWdnZXJCb3VuZHMudG9wIC0gZWxlbWVudEhlaWdodCAtIFNQQUNFX0ZST01fVE9QKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9XG4gICAgICAgICAgICAgIHdpbmRvd0hlaWdodCAtIGhvc3RUb3BQb3NpdGlvbiAtIFNQQUNFX0ZST01fQk9UVE9NICsgUE9TSVRJT05fTUVBU1VSRV9VTklUO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnR5cGUgPT09ICdjb250ZXh0Jykge1xuICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgK3RoaXMuY29uZmlnLmJvdW5kcy50b3AgKyBTUEFDRV9GUk9NX1RPUCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3dpdGNoICh0aGlzLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsIHRyaWdnZXJCb3VuZHMudG9wICsgdHJpZ2dlckJvdW5kcy5oZWlnaHQgKyBTUEFDRV9GUk9NX1RPUCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCB0cmlnZ2VyQm91bmRzLnRvcCAtIGVsZW1lbnRIZWlnaHQgLSBTUEFDRV9GUk9NX1RPUCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZShcbiAgICAgICAgICAgICAgICAndG9wJyxcbiAgICAgICAgICAgICAgICB0cmlnZ2VyQm91bmRzLnRvcCAtIChlbGVtZW50SGVpZ2h0IC8gMiAtIHRyaWdnZXJCb3VuZHMuaGVpZ2h0IC8gMilcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmNvbmZpZy50cmlnZ2VyRGlyZWN0aXZlKSB7XG4gICAgICBjb25zdCBob3N0Qm91bmRzID0gdGhpcy5jb25maWcuc3VibWVudVRyaWdnZXJlZEl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgaG9zdFBvc2l0aW9uID0gaG9zdEJvdW5kcy50b3A7XG5cbiAgICAgIGlmIChlbGVtZW50SGVpZ2h0ID49IHdpbmRvd0hlaWdodCAtIGhvc3RQb3NpdGlvbiAtIFNQQUNFX0ZST01fQk9UVE9NKSB7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBlbGVtZW50SGVpZ2h0IC0gKHdpbmRvd0hlaWdodCAtIGhvc3RQb3NpdGlvbik7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgaG9zdFBvc2l0aW9uIC0gZGlmZiAtIFNQQUNFX0ZST01fQk9UVE9NKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgaG9zdFBvc2l0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldExlZnRQb3NpdGlvbigpOiB2b2lkIHtcbiAgICBjb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIGNvbnN0IGVsZW1lbnRXaWR0aCA9IHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICBjb25zdCB0cmlnZ2VyQm91bmRzID0gdGhpcy5jb25maWcudHJpZ2dlckVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGlmICh0aGlzLmlzQ29udGV4dFR5cGUpIHtcbiAgICAgIGlmICgrdGhpcy5jb25maWcuYm91bmRzLmxlZnQgPj0gd2luZG93V2lkdGggLyAyKSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsICt0aGlzLmNvbmZpZy5ib3VuZHMubGVmdCAtIGVsZW1lbnRXaWR0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCB0aGlzLmRlZmF1bHRMZWZ0UG9zaXRpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcudHJpZ2dlckRpcmVjdGl2ZSkge1xuICAgICAgc3dpdGNoICh0aGlzLnBvc2l0aW9uKSB7XG4gICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgdHJpZ2dlckJvdW5kcy5sZWZ0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgdHJpZ2dlckJvdW5kcy5sZWZ0IC0gZWxlbWVudFdpZHRoIC0gSE9SSVpPTlRBTF9TUEFDRSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCB0cmlnZ2VyQm91bmRzLmxlZnQgKyB0cmlnZ2VyQm91bmRzLndpZHRoICsgSE9SSVpPTlRBTF9TUEFDRSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhvc3RSZWNCb3VuZHMgPSB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgIGlmIChob3N0UmVjQm91bmRzLnJpZ2h0ID4gd2luZG93V2lkdGggLSAyMCkge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCBob3N0UmVjQm91bmRzLmxlZnQgLSAoaG9zdFJlY0JvdW5kcy5yaWdodCAtIHdpbmRvd1dpZHRoICsgMjApKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGhvc3RSZWNCb3VuZHMubGVmdCA8IDApIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgMTUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBob3N0Qm91bmRzID0gdGhpcy5jb25maWcuc3VibWVudVRyaWdnZXJlZEl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICBpZiAoZWxlbWVudFdpZHRoID4gd2luZG93V2lkdGggLSBob3N0Qm91bmRzLnJpZ2h0KSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIGhvc3RCb3VuZHMubGVmdCAtIHRoaXMuaW5pdEhvc3RFbGVtZW50V2lkdGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgaG9zdEJvdW5kcy5yaWdodCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRXaWR0aCgpOiB2b2lkIHtcbiAgICBjb25zdCB0cmlnZ2VyQm91bmRzOiBDbGllbnRSZWN0ID0gdGhpcy5jb25maWcudHJpZ2dlckVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGlmICghdGhpcy5pc0NvbnRleHRUeXBlICYmICF0aGlzLmlzU3VibWVudVR5cGUpIHtcbiAgICAgIGNvbnN0IHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICBjb25zdCBob3N0RWxCb3VuZHMgPSB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMuaW5pdEhvc3RFbGVtZW50V2lkdGggKyBQT1NJVElPTl9NRUFTVVJFX1VOSVQ7XG5cbiAgICAgIGlmICghdGhpcy5pc01lbnVUeXBlKSB7XG4gICAgICAgIGlmIChob3N0RWxCb3VuZHMud2lkdGggPiB3aW5kb3dXaWR0aCB8fCB0aGlzLmluaXRIb3N0RWxlbWVudFdpZHRoID4gd2luZG93V2lkdGggLSAzMCkge1xuICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS53aWR0aCA9IHdpbmRvd1dpZHRoIC0gMzAgKyBQT1NJVElPTl9NRUFTVVJFX1VOSVQ7XG4gICAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gd2luZG93V2lkdGggLSAzMCArIFBPU0lUSU9OX01FQVNVUkVfVU5JVDtcbiAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCAxNSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFBvc2l0aW9uU3R5bGUocHJvcGVydHk6ICd0b3AnIHwgJ2xlZnQnLCB2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlW3Byb3BlcnR5XSA9IHZhbHVlICsgUE9TSVRJT05fTUVBU1VSRV9VTklUO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgZGVmYXVsdExlZnRQb3NpdGlvbigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5ib3VuZHMubGVmdDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGNhbkFzc2lnblBhZGRpbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICghdGhpcy5pc0NvbnRleHRUeXBlICYmICF0aGlzLmlzTWVudVR5cGUgJiYgIXRoaXMuaXNTdWJtZW51VHlwZSkgfHxcbiAgICAgICh0aGlzLmlzU3VibWVudVR5cGUgJiYgISF0aGlzLmNvbmZpZy5jb250ZW50KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldCBpc0NvbnRleHRUeXBlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdjb250ZXh0JztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGlzTWVudVR5cGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ21lbnUnO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaXNTdWJtZW51VHlwZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50eXBlID09PSAnc3VibWVudSc7XG4gIH1cblxuICBwcml2YXRlIGdldCBpc1Rvb2x0aXAoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ3Rvb2x0aXAnO1xuICB9XG59XG4iXX0=