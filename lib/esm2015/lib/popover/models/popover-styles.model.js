const SPACE_FROM_BOTTOM = 20;
const SPACE_FROM_TOP = 10;
const HORIZONTAL_SPACE = 10;
const POSITION_MEASURE_UNIT = 'px';
export class PopoverStyles {
    constructor(popover) {
        this.initHostElementWidth = 0;
        this.popover = popover;
        this.hostElement = popover.element;
        this.config = popover.popoverConfig;
        this.type = this.config.type;
        this.position = this.config.position;
    }
    init() {
        const hostBounds = this.config.bounds;
        this.hostElement.nativeElement.style.zIndex = 10000;
        this.setPositionStyle('left', 0);
        this.setPositionStyle('top', +hostBounds.top + hostBounds.height + SPACE_FROM_TOP);
        if (!this.isContextType && !this.isSubmenuType) {
            this.hostElement.nativeElement.style.minWidth = hostBounds.width + 'px';
        }
        if (this.isContextType) {
            this.setPositionStyle('top', +hostBounds.top);
            this.hostElement.nativeElement.style.minWidth = 0;
        }
        if (this.isSubmenuType) {
            const triggerItem = this.config.submenuTriggeredItem.element.nativeElement;
            const triggerBounds = triggerItem.getBoundingClientRect();
            this.hostElement.nativeElement.style.minWidth = 0;
            this.setPositionStyle('top', triggerBounds.top);
        }
        if (this.canAssignPadding) {
            const padding = this.isTooltip ? '8px 12px' : '15px 25px';
            this.popover.popoverWrapperEl.nativeElement.style.padding = padding;
        }
        this.hostElement.nativeElement.style.visibility = 'hidden';
        setTimeout(() => {
            this.initHostElementWidth = this.hostElement.nativeElement.offsetWidth + 1;
            this.hostElement.nativeElement.style.minWidth = this.initHostElementWidth + 'px';
        });
    }
    update() {
        this.setLeftPosition();
        this.setTopPosition();
        this.setWidth();
        this.hostElement.nativeElement.style.visibility = 'visible';
    }
    setTopPosition() {
        const windowHeight = window.innerHeight;
        const elementHeight = this.hostElement.nativeElement.getBoundingClientRect().height;
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (this.config.triggerDirective) {
            const hostTopPosition = this.config.type === 'context' ? this.config.bounds.top : triggerBounds.top + triggerBounds.height;
            const isBelowWindowCenterHeight = elementHeight >= windowHeight - hostTopPosition - SPACE_FROM_BOTTOM;
            if (isBelowWindowCenterHeight) {
                if (this.config.type === 'context') {
                    this.setPositionStyle('top', +this.config.bounds.top - elementHeight + SPACE_FROM_TOP);
                }
                else {
                    const newPos = triggerBounds.top - elementHeight - SPACE_FROM_TOP;
                    if (newPos > 0) {
                        switch (this.position) {
                            case 'bottom':
                                this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);
                                break;
                            case 'top':
                                this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);
                        }
                    }
                    else {
                        this.hostElement.nativeElement.style.height =
                            windowHeight - hostTopPosition - SPACE_FROM_BOTTOM + POSITION_MEASURE_UNIT;
                    }
                }
            }
            else {
                if (this.config.type === 'context') {
                    this.setPositionStyle('top', +this.config.bounds.top + SPACE_FROM_TOP);
                }
                else {
                    switch (this.position) {
                        case 'bottom':
                            this.setPositionStyle('top', triggerBounds.top + triggerBounds.height + SPACE_FROM_TOP);
                            break;
                        case 'top':
                            this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);
                            break;
                        case 'left':
                        case 'right':
                            this.setPositionStyle('top', triggerBounds.top - (elementHeight / 2 - triggerBounds.height / 2));
                            break;
                    }
                }
            }
        }
        if (!this.config.triggerDirective) {
            const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();
            const hostPosition = hostBounds.top;
            if (elementHeight >= windowHeight - hostPosition - SPACE_FROM_BOTTOM) {
                const diff = elementHeight - (windowHeight - hostPosition);
                this.setPositionStyle('top', hostPosition - diff - SPACE_FROM_BOTTOM);
            }
            else {
                this.setPositionStyle('top', hostPosition);
            }
        }
    }
    setLeftPosition() {
        const windowWidth = window.innerWidth;
        const elementWidth = this.hostElement.nativeElement.getBoundingClientRect().width;
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (this.isContextType) {
            if (+this.config.bounds.left >= windowWidth / 2) {
                this.setPositionStyle('left', +this.config.bounds.left - elementWidth);
            }
            else {
                this.setPositionStyle('left', this.defaultLeftPosition);
            }
        }
        else if (this.config.triggerDirective) {
            switch (this.position) {
                case 'bottom':
                case 'top':
                    this.setPositionStyle('left', triggerBounds.left);
                    break;
                case 'left':
                    this.setPositionStyle('left', triggerBounds.left - elementWidth - HORIZONTAL_SPACE);
                    break;
                case 'right':
                    this.setPositionStyle('left', triggerBounds.left + triggerBounds.width + HORIZONTAL_SPACE);
                    break;
            }
            const hostRecBounds = this.hostElement.nativeElement.getBoundingClientRect();
            if (hostRecBounds.right > windowWidth - 20) {
                this.setPositionStyle('left', hostRecBounds.left - (hostRecBounds.right - windowWidth + 20));
            }
            if (hostRecBounds.left < 0) {
                this.setPositionStyle('left', 15);
            }
        }
        else {
            const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();
            if (elementWidth > windowWidth - hostBounds.right) {
                this.setPositionStyle('left', hostBounds.left - this.initHostElementWidth);
            }
            else {
                this.setPositionStyle('left', hostBounds.right);
            }
        }
    }
    setWidth() {
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (!this.isContextType && !this.isSubmenuType) {
            const windowWidth = window.innerWidth;
            const hostElBounds = this.hostElement.nativeElement.getBoundingClientRect();
            this.hostElement.nativeElement.style.minWidth = this.initHostElementWidth + POSITION_MEASURE_UNIT;
            if (!this.isMenuType) {
                if (hostElBounds.width > windowWidth || this.initHostElementWidth > windowWidth - 30) {
                    this.hostElement.nativeElement.style.width = windowWidth - 30 + POSITION_MEASURE_UNIT;
                    this.hostElement.nativeElement.style.minWidth = windowWidth - 30 + POSITION_MEASURE_UNIT;
                    this.setPositionStyle('left', 15);
                }
            }
        }
    }
    setPositionStyle(property, value) {
        this.hostElement.nativeElement.style[property] = value + POSITION_MEASURE_UNIT;
    }
    get defaultLeftPosition() {
        return this.config.bounds.left;
    }
    get canAssignPadding() {
        return ((!this.isContextType && !this.isMenuType && !this.isSubmenuType) ||
            (this.isSubmenuType && !!this.config.content));
    }
    get isContextType() {
        return this.type === 'context';
    }
    get isMenuType() {
        return this.type === 'menu';
    }
    get isSubmenuType() {
        return this.type === 'submenu';
    }
    get isTooltip() {
        return this.type === 'tooltip';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci1zdHlsZXMubW9kZWwuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvZm9sdGkvUHJvamVjdHMvbmctcG9wcHkvcHJvamVjdHMvbGliL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9wb3BvdmVyL21vZGVscy9wb3BvdmVyLXN0eWxlcy5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFLQSxNQUFNLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztBQUM3QixNQUFNLGNBQWMsR0FBRyxFQUFFLENBQUM7QUFDMUIsTUFBTSxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7QUFDNUIsTUFBTSxxQkFBcUIsR0FBRyxJQUFJLENBQUM7QUFFbkMsTUFBTSxPQUFPLGFBQWE7SUFReEIsWUFBWSxPQUFnQztRQUZwQyx5QkFBb0IsR0FBVyxDQUFDLENBQUM7UUFHdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDO1FBQ25DLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQztRQUNwQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQzdCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7SUFDdkMsQ0FBQztJQUVELElBQUk7UUFDRixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUV0QyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUVwRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEdBQUcsY0FB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LENBQUM7SUFDakMsQ0FBQztJQUVELElBQVksVUFBVTtRQUNwQixPQUFPLElBQUksQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDO0lBQzlCLENBQUM7SUFFRCxJQUFZLGFBQWE7UUFDdkIsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsSUFBWSxTQUFTO1FBQ25CLE9BQU8sSUFBSSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUM7SUFDakMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUG9wb3ZlckNvbmZpZyB9IGZyb20gJy4uL3BvcG92ZXIudG9rZW4nO1xuaW1wb3J0IHsgUG9wb3ZlclBvc2l0aW9uLCBQb3BvdmVyVHlwZSB9IGZyb20gJy4uL3BvcG92ZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvcG92ZXJDb250ZW50Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cy9wb3BvdmVyLWNvbnRlbnQvcG9wb3Zlci1jb250ZW50LmNvbXBvbmVudCc7XG5cbmNvbnN0IFNQQUNFX0ZST01fQk9UVE9NID0gMjA7XG5jb25zdCBTUEFDRV9GUk9NX1RPUCA9IDEwO1xuY29uc3QgSE9SSVpPTlRBTF9TUEFDRSA9IDEwO1xuY29uc3QgUE9TSVRJT05fTUVBU1VSRV9VTklUID0gJ3B4JztcblxuZXhwb3J0IGNsYXNzIFBvcG92ZXJTdHlsZXMge1xuICBwcml2YXRlIHBvcG92ZXI6IFBvcG92ZXJDb250ZW50Q29tcG9uZW50O1xuICBwcml2YXRlIGhvc3RFbGVtZW50OiBFbGVtZW50UmVmPGFueT47XG4gIHByaXZhdGUgY29uZmlnOiBQb3BvdmVyQ29uZmlnO1xuICBwcml2YXRlIHR5cGU6IFBvcG92ZXJUeXBlO1xuICBwcml2YXRlIHBvc2l0aW9uOiBQb3BvdmVyUG9zaXRpb247XG4gIHByaXZhdGUgaW5pdEhvc3RFbGVtZW50V2lkdGg6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IocG9wb3ZlcjogUG9wb3ZlckNvbnRlbnRDb21wb25lbnQpIHtcbiAgICB0aGlzLnBvcG92ZXIgPSBwb3BvdmVyO1xuICAgIHRoaXMuaG9zdEVsZW1lbnQgPSBwb3BvdmVyLmVsZW1lbnQ7XG4gICAgdGhpcy5jb25maWcgPSBwb3BvdmVyLnBvcG92ZXJDb25maWc7XG4gICAgdGhpcy50eXBlID0gdGhpcy5jb25maWcudHlwZTtcbiAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy5jb25maWcucG9zaXRpb247XG4gIH1cblxuICBpbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IGhvc3RCb3VuZHMgPSB0aGlzLmNvbmZpZy5ib3VuZHM7XG5cbiAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUuekluZGV4ID0gMTAwMDA7XG5cbiAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCAwKTtcbiAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsICtob3N0Qm91bmRzLnRvcCArIGhvc3RCb3VuZHMuaGVpZ2h0ICsgU1BBQ0VfRlJPTV9UT1ApO1xuXG4gICAgaWYgKCF0aGlzLmlzQ29udGV4dFR5cGUgJiYgIXRoaXMuaXNTdWJtZW51VHlwZSkge1xuICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gaG9zdEJvdW5kcy53aWR0aCArICdweCc7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNDb250ZXh0VHlwZSkge1xuICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCAraG9zdEJvdW5kcy50b3ApO1xuICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gMDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1N1Ym1lbnVUeXBlKSB7XG4gICAgICBjb25zdCB0cmlnZ2VySXRlbSA9IHRoaXMuY29uZmlnLnN1Ym1lbnVUcmlnZ2VyZWRJdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICAgIGNvbnN0IHRyaWdnZXJCb3VuZHM6IENsaWVudFJlY3QgPSB0cmlnZ2VySXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gMDtcbiAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgdHJpZ2dlckJvdW5kcy50b3ApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNhbkFzc2lnblBhZGRpbmcpIHtcbiAgICAgIGNvbnN0IHBhZGRpbmcgPSB0aGlzLmlzVG9vbHRpcCA/ICc4cHggMTJweCcgOiAnMTVweCAyNXB4JztcbiAgICAgIHRoaXMucG9wb3Zlci5wb3BvdmVyV3JhcHBlckVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUucGFkZGluZyA9IHBhZGRpbmc7XG4gICAgfVxuXG4gICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5pbml0SG9zdEVsZW1lbnRXaWR0aCA9IHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCArIDE7XG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSB0aGlzLmluaXRIb3N0RWxlbWVudFdpZHRoICsgJ3B4JztcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLnNldExlZnRQb3NpdGlvbigpO1xuICAgIHRoaXMuc2V0VG9wUG9zaXRpb24oKTtcbiAgICB0aGlzLnNldFdpZHRoKCk7XG5cbiAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcbiAgfVxuXG4gIHByaXZhdGUgc2V0VG9wUG9zaXRpb24oKTogdm9pZCB7XG4gICAgY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgIGNvbnN0IGVsZW1lbnRIZWlnaHQgPSB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgIGNvbnN0IHRyaWdnZXJCb3VuZHMgPSB0aGlzLmNvbmZpZy50cmlnZ2VyRWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLnRyaWdnZXJEaXJlY3RpdmUpIHtcbiAgICAgIGNvbnN0IGhvc3RUb3BQb3NpdGlvbiA9XG4gICAgICAgIHRoaXMuY29uZmlnLnR5cGUgPT09ICdjb250ZXh0JyA/IHRoaXMuY29uZmlnLmJvdW5kcy50b3AgOiB0cmlnZ2VyQm91bmRzLnRvcCArIHRyaWdnZXJCb3VuZHMuaGVpZ2h0O1xuICAgICAgY29uc3QgaXNCZWxvd1dpbmRvd0NlbnRlckhlaWdodCA9IGVsZW1lbnRIZWlnaHQgPj0gd2luZG93SGVpZ2h0IC0gaG9zdFRvcFBvc2l0aW9uIC0gU1BBQ0VfRlJPTV9CT1RUT007XG5cbiAgICAgIGlmIChpc0JlbG93V2luZG93Q2VudGVySGVpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy50eXBlID09PSAnY29udGV4dCcpIHtcbiAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsICt0aGlzLmNvbmZpZy5ib3VuZHMudG9wIC0gZWxlbWVudEhlaWdodCArIFNQQUNFX0ZST01fVE9QKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBuZXdQb3MgPSB0cmlnZ2VyQm91bmRzLnRvcCAtIGVsZW1lbnRIZWlnaHQgLSBTUEFDRV9GUk9NX1RPUDtcbiAgICAgICAgICBpZiAobmV3UG9zID4gMCkge1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCB0cmlnZ2VyQm91bmRzLnRvcCAtIGVsZW1lbnRIZWlnaHQgLSBTUEFDRV9GUk9NX1RPUCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCB0cmlnZ2VyQm91bmRzLnRvcCAtIGVsZW1lbnRIZWlnaHQgLSBTUEFDRV9GUk9NX1RPUCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgPVxuICAgICAgICAgICAgICB3aW5kb3dIZWlnaHQgLSBob3N0VG9wUG9zaXRpb24gLSBTUEFDRV9GUk9NX0JPVFRPTSArIFBPU0lUSU9OX01FQVNVUkVfVU5JVDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy50eXBlID09PSAnY29udGV4dCcpIHtcbiAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsICt0aGlzLmNvbmZpZy5ib3VuZHMudG9wICsgU1BBQ0VfRlJPTV9UT1ApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAodGhpcy5wb3NpdGlvbikge1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCB0cmlnZ2VyQm91bmRzLnRvcCArIHRyaWdnZXJCb3VuZHMuaGVpZ2h0ICsgU1BBQ0VfRlJPTV9UT1ApO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgdHJpZ2dlckJvdW5kcy50b3AgLSBlbGVtZW50SGVpZ2h0IC0gU1BBQ0VfRlJPTV9UT1ApO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoXG4gICAgICAgICAgICAgICAgJ3RvcCcsXG4gICAgICAgICAgICAgICAgdHJpZ2dlckJvdW5kcy50b3AgLSAoZWxlbWVudEhlaWdodCAvIDIgLSB0cmlnZ2VyQm91bmRzLmhlaWdodCAvIDIpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghdGhpcy5jb25maWcudHJpZ2dlckRpcmVjdGl2ZSkge1xuICAgICAgY29uc3QgaG9zdEJvdW5kcyA9IHRoaXMuY29uZmlnLnN1Ym1lbnVUcmlnZ2VyZWRJdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IGhvc3RQb3NpdGlvbiA9IGhvc3RCb3VuZHMudG9wO1xuXG4gICAgICBpZiAoZWxlbWVudEhlaWdodCA+PSB3aW5kb3dIZWlnaHQgLSBob3N0UG9zaXRpb24gLSBTUEFDRV9GUk9NX0JPVFRPTSkge1xuICAgICAgICBjb25zdCBkaWZmID0gZWxlbWVudEhlaWdodCAtICh3aW5kb3dIZWlnaHQgLSBob3N0UG9zaXRpb24pO1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsIGhvc3RQb3NpdGlvbiAtIGRpZmYgLSBTUEFDRV9GUk9NX0JPVFRPTSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsIGhvc3RQb3NpdGlvbik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRMZWZ0UG9zaXRpb24oKTogdm9pZCB7XG4gICAgY29uc3Qgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICBjb25zdCBlbGVtZW50V2lkdGggPSB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgY29uc3QgdHJpZ2dlckJvdW5kcyA9IHRoaXMuY29uZmlnLnRyaWdnZXJFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBpZiAodGhpcy5pc0NvbnRleHRUeXBlKSB7XG4gICAgICBpZiAoK3RoaXMuY29uZmlnLmJvdW5kcy5sZWZ0ID49IHdpbmRvd1dpZHRoIC8gMikge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCArdGhpcy5jb25maWcuYm91bmRzLmxlZnQgLSBlbGVtZW50V2lkdGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgdGhpcy5kZWZhdWx0TGVmdFBvc2l0aW9uKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLnRyaWdnZXJEaXJlY3RpdmUpIHtcbiAgICAgIHN3aXRjaCAodGhpcy5wb3NpdGlvbikge1xuICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICBjYXNlICd0b3AnOlxuICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIHRyaWdnZXJCb3VuZHMubGVmdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIHRyaWdnZXJCb3VuZHMubGVmdCAtIGVsZW1lbnRXaWR0aCAtIEhPUklaT05UQUxfU1BBQ0UpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgdHJpZ2dlckJvdW5kcy5sZWZ0ICsgdHJpZ2dlckJvdW5kcy53aWR0aCArIEhPUklaT05UQUxfU1BBQ0UpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBob3N0UmVjQm91bmRzID0gdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICBpZiAoaG9zdFJlY0JvdW5kcy5yaWdodCA+IHdpbmRvd1dpZHRoIC0gMjApIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgaG9zdFJlY0JvdW5kcy5sZWZ0IC0gKGhvc3RSZWNCb3VuZHMucmlnaHQgLSB3aW5kb3dXaWR0aCArIDIwKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChob3N0UmVjQm91bmRzLmxlZnQgPCAwKSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIDE1KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaG9zdEJvdW5kcyA9IHRoaXMuY29uZmlnLnN1Ym1lbnVUcmlnZ2VyZWRJdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgaWYgKGVsZW1lbnRXaWR0aCA+IHdpbmRvd1dpZHRoIC0gaG9zdEJvdW5kcy5yaWdodCkge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCBob3N0Qm91bmRzLmxlZnQgLSB0aGlzLmluaXRIb3N0RWxlbWVudFdpZHRoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIGhvc3RCb3VuZHMucmlnaHQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0V2lkdGgoKTogdm9pZCB7XG4gICAgY29uc3QgdHJpZ2dlckJvdW5kczogQ2xpZW50UmVjdCA9IHRoaXMuY29uZmlnLnRyaWdnZXJFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBpZiAoIXRoaXMuaXNDb250ZXh0VHlwZSAmJiAhdGhpcy5pc1N1Ym1lbnVUeXBlKSB7XG4gICAgICBjb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgY29uc3QgaG9zdEVsQm91bmRzID0gdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSB0aGlzLmluaXRIb3N0RWxlbWVudFdpZHRoICsgUE9TSVRJT05fTUVBU1VSRV9VTklUO1xuXG4gICAgICBpZiAoIXRoaXMuaXNNZW51VHlwZSkge1xuICAgICAgICBpZiAoaG9zdEVsQm91bmRzLndpZHRoID4gd2luZG93V2lkdGggfHwgdGhpcy5pbml0SG9zdEVsZW1lbnRXaWR0aCA+IHdpbmRvd1dpZHRoIC0gMzApIHtcbiAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUud2lkdGggPSB3aW5kb3dXaWR0aCAtIDMwICsgUE9TSVRJT05fTUVBU1VSRV9VTklUO1xuICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHdpbmRvd1dpZHRoIC0gMzAgKyBQT1NJVElPTl9NRUFTVVJFX1VOSVQ7XG4gICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgMTUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRQb3NpdGlvblN0eWxlKHByb3BlcnR5OiAndG9wJyB8ICdsZWZ0JywgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZVtwcm9wZXJ0eV0gPSB2YWx1ZSArIFBPU0lUSU9OX01FQVNVUkVfVU5JVDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGRlZmF1bHRMZWZ0UG9zaXRpb24oKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuYm91bmRzLmxlZnQ7XG4gIH1cblxuICBwcml2YXRlIGdldCBjYW5Bc3NpZ25QYWRkaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICAoIXRoaXMuaXNDb250ZXh0VHlwZSAmJiAhdGhpcy5pc01lbnVUeXBlICYmICF0aGlzLmlzU3VibWVudVR5cGUpIHx8XG4gICAgICAodGhpcy5pc1N1Ym1lbnVUeXBlICYmICEhdGhpcy5jb25maWcuY29udGVudClcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaXNDb250ZXh0VHlwZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50eXBlID09PSAnY29udGV4dCc7XG4gIH1cblxuICBwcml2YXRlIGdldCBpc01lbnVUeXBlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdtZW51JztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGlzU3VibWVudVR5cGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ3N1Ym1lbnUnO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaXNUb29sdGlwKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICd0b29sdGlwJztcbiAgfVxufVxuIl19